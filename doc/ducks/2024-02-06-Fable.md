---
date: 2024-02-06
---


## Motivation

I've started working with Fable on some projects, it'd be nice to use FsSpec on them.

But, fable requires special packaging and might not work with some of the .NET features I rely on.


## Exploration

Q: How do I package for fable?
- A: https://fable.io/docs/your-fable-project/author-a-fable-library.html

Q: What fable-unsupported features might I rely on?
- SpecData
  - `IComparable<T>` is uncertain, everything else looks ok
- Default Validators
  - a few type tests :? String and :? IEnumerable
- SpecModule
  - `isLeafValidForType` uses `isAssignableFrom`, but this method is only used by the FsCheck data generation, so I could easily move it out
- Normalization: everything looks ok
- Formatters: looks ok
- Summary: the biggest risks for the core library are IComparable and the type tests
  - The type tests are pretty simple and should be types I can differentiate in javascript. If necessary, I might be able to break out a test that compiles differently based on Fable / non-fable


What now?
- the easiest thing to test would be IComparable

Q: Does Fable support IComparable?
- it's not listed in [.NET compatability](https://fable.io/docs/javascript/compatibility.html)
- a quick repo search shows that the various languages seems to all have implementations for IComparable https://github.com/search?q=repo%3Afable-compiler%2FFable%20Icomparable&type=code
- A quick [fable interactive](https://fable.io/repl/) test fails to compile `System.Int32.CompareTo is not supported by Fable`
  - ```fsharp
        type Boi (n:int) =
        member _.n = n
        interface IComparable<Boi> with
            member this.CompareTo(other: Boi) : int = 
                this.n.CompareTo(other.n)

        console.log([|Boi(2); Boi(99); Boi(1)|] |> Array.sortBy (fun b -> b.n))```
  - It works fine if I write my own compareTo implementation
  - ```fsharp
        type Boi (n:int) =
            member _.n = n
            interface IComparable<Boi> with
                member this.CompareTo(other: Boi) : int = 
                    if this.n = other.n then 0
                    else if (this.n > other.n) then 1
                    else -1 ```
- A: Looks like I can't count on being able to call CompareTo on native types...
  - This pretty much undermines trying to support fable. 
- Q: What about non-generic IComparable. I feel like I saw that used in numerous posts?
  - actually, types are erased. If I need different validators for JS anyway, then I might be able to rely on dynamic interop features on comparison and still get the compile-time validation without actually using the CompareTo function
  - I'm not sure how they manage it for list sorts and such...


options for type testing https://github.com/fable-compiler/Fable/issues/1981